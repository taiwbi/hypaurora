#!/usr/bin/env bash
set -euo pipefail

show_usage() {
  echo "Usage: $0 --raise PERCENT | --lower PERCENT | --toggle-mute"
  echo "  --raise PERCENT    Increase volume by PERCENT (clamped 0..100)"
  echo "  --lower PERCENT    Decrease volume by PERCENT (clamped 0..100)"
  echo "  --toggle-mute      Toggle mute state"
  exit 1
}

get_volume() {
  pactl get-sink-volume @DEFAULT_SINK@ | grep -o '[0-9]\+%' | head -1 | tr -d '%'
}

set_volume_to() {
  local v="$1"
  if (( v < 0 )); then v=0; fi
  if (( v > 100 )); then v=100; fi
  pactl set-sink-volume @DEFAULT_SINK@ "${v}%"
}

raise_volume() {
  local inc="$1"
  local cur
  cur="$(get_volume)"
  set_volume_to $(( cur + inc ))
}

lower_volume() {
  local dec="$1"
  local cur
  cur="$(get_volume)"
  set_volume_to $(( cur - dec ))
}

toggle_mute() {
  pactl set-sink-mute @DEFAULT_SINK@ toggle
}

[[ $# -gt 0 ]] || show_usage

case "${1:-}" in
  --raise)
    [[ ${2:-} =~ ^[0-9]+$ ]] || show_usage
    raise_volume "$2"
    ;;
  --lower)
    [[ ${2:-} =~ ^[0-9]+$ ]] || show_usage
    lower_volume "$2"
    ;;
  --toggle-mute)
    toggle_mute
    ;;
  *)
    show_usage
    ;;
esac
