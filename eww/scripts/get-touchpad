#!/usr/bin/env bash

# Script to get current touchpad status for eww bar

# Set up XDG_RUNTIME_DIR if not set
if [ "$XDG_RUNTIME_DIR" = "" ]; then
    export XDG_RUNTIME_DIR=/run/user/$(id -u)
fi

STATUS_FILE="$XDG_RUNTIME_DIR/touchpad.status"

# Function to get touchpad status
get_touchpad_status() {
    if [ -f "$STATUS_FILE" ]; then
        cat "$STATUS_FILE"
    else
        echo "false"
    fi
    echo ""
}

# Print initial status
get_touchpad_status

# Watch for changes to the status file
while true; do
    # Use inotifywait to monitor the status file for changes
    if command -v inotifywait >/dev/null 2>&1; then
        # Wait for file to be modified or created
        inotifywait -e modify,create,moved_to "$STATUS_FILE" >/dev/null 2>&1
    else
        # Fallback: poll every 0.5 seconds if inotifywait is not available
        sleep 0.5
    fi
    
    # Print the new status
    get_touchpad_status
done
