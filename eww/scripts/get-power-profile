#!/usr/bin/env bash

# Function to get current power profile
get_profile() {
    gdbus call --system --dest net.hadess.PowerProfiles \
      --object-path /net/hadess/PowerProfiles \
      --method org.freedesktop.DBus.Properties.Get \
      net.hadess.PowerProfiles ActiveProfile | \
      grep -o "'[^']*'" | tr -d "'"
}

# Print current profile first
get_profile

# Listen for property changes on the PowerProfiles interface
gdbus monitor --system --dest net.hadess.PowerProfiles \
  --object-path /net/hadess/PowerProfiles | \
  while IFS= read -r line; do
    # Look for lines containing profile names (power-saver, balanced, performance)
    if echo "$line" | grep -qE "'(power-saver|balanced|performance)'"; then
        # Extract the profile value
        new_profile=$(echo "$line" | grep -oE "(power-saver|balanced|performance)")
        echo "$new_profile"
    fi
  done
