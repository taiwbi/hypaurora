#!/bin/bash

# Detect the operating system
get_volume() {
    local volume

    # macOS
    if [[ "$OSTYPE" == "darwin"* ]]; then
        # Use osascript to get volume
        volume=$(osascript -e 'output volume of (get volume settings)')
    
    # Linux (using ALSA)
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        # Use amixer to get volume percentage
        volume=$(amixer get Master | grep -oP '\d+%' | head -1 | tr -d '%')
    
    else
        echo "Unsupported operating system" >&2
        exit 1
    fi

    # Output volume in JSON format
    printf '{"volume":%d}\n' "$volume"
}

# Call the function
get_volume
