#!/usr/bin/env bash

# Function to get current keyboard layout name
get_current_layout() {
    niri msg keyboard-layouts | grep '^\s*\*' | sed 's/^\s*\*\s*[0-9]\+\s*//'
}

# Print initial layout
echo "$(get_current_layout)"

# Monitor niri socket for keyboard layout changes
niri msg event-stream | while read -r event; do
    # Check if the event is related to keyboard layout changes
    if echo "$event" | grep -q "Keyboard layout switched"; then
        current_layout=$(get_current_layout)
        echo "$current_layout"
    fi
done
