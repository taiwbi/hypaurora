#!/usr/bin/env bash

# Set power profile with validation using D-Bus
if [ $# -eq 0 ]; then
    echo "Usage: $0 <profile>"
    echo "Available profiles: power-saver, balanced, performance"
    exit 1
fi

profile="$1"

# Validate profile name
case "$profile" in
    power-saver|balanced|performance)
        gdbus call --system --dest net.hadess.PowerProfiles \
          --object-path /net/hadess/PowerProfiles \
          --method org.freedesktop.DBus.Properties.Set \
          net.hadess.PowerProfiles ActiveProfile "<'$profile'>" > /dev/null 2>&1
        
        if [ $? -eq 0 ]; then
            echo "Power profile set to: $profile"
        else
            echo "Failed to set power profile to: $profile"
            echo "Make sure power-profiles-daemon is running and you have appropriate permissions"
            exit 1
        fi
        ;;
    *)
        echo "Invalid profile: $profile"
        echo "Valid profiles are: power-saver, balanced, performance"
        exit 1
        ;;
esac
